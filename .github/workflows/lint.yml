name: Lint using Rubocop

on:
  push:
    branches:
      - "!main" # Matches branches other than 'main'
      - "!gh-pages" # Matches branches other than 'gh-pages'
      - "main"
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - name: Send Slack Starting Deployment message
      id: slack-start
      uses: slackapi/slack-github-action@v1.24.0
      with:
        channel-id: "C04JZM55VC2"
        payload: |
          {
            "text": "Deployment started (In Progress)",
            "attachments": [
              {
                "pretext": "Deployment started",
                "color": "dbab09",
                "fields": [
                  {
                    "title": "Status",
                    "short": true,
                    "value": "In Progress"
                  },
                  {
                    "title": "Branch",
                    "short": true,
                    "value": "{{$GITHUB_HEAD_REF}}"
                  }
                ]
              }
            ]
          }
      env:
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN}}
    
    - name: Checkout
      uses: actions/checkout@v2
    
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 2.7
    
    - name: Install dependencies
      run: gem install rubocop

    - name: Run RuboCop
      run: rubocop

    - name: Send Slack Deployment Complete message
      id: slack-update
      uses: slackapi/slack-github-action@v1.24.0
      with:
        channel-id: "C04JZM55VC2"
        update-ts: ${{ steps.slack-start.outputs.ts }}
        payload: |
          {
            "text": "Deployment finished (Completed)",
            "attachments": [
              {
                "pretext": "Deployment finished",
                "color": "28a745",
                "fields": [
                  {
                    "title": "Status",
                    "short": true,
                    "value": "Completed"
                  }
                ]
              }
            ]
          }
      env:
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN}}

    # - name: Post to a Slack channel
    #   id: slack
    #   uses: slackapi/slack-github-action@v1.23.0
    #   with:
    #     # Slack channel ID where message will be posted. Needed if using bot token
    #     channel-id: "C04JZM55VC2"
    #     # Message to post into Slack. Needed if using bot token
    #     payload: |
    #       {
    #         "text": "MacServer Documentation Build result:\n${{ job.status }}\n${{ github.event.pull_request.html_url || github.event.head_commit.url }}",
    #         "blocks": [
    #           {
    #             "type": "section",
    #             "text": {
    #               "type": "mrkdwn",
    #               "text": "MacSetup build result:\n${{ job.status }}\n\n${{ github.event.pull_request.html_url || github.event.head_commit.url }}"
    #             }
    #           }
    #         ]
    #       }
    #   env:
    #     SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
